#!/usr/bin/env -S bash -i

get_user() {
    secret-tool search client bugzilla-cli workstation wintermute 2>&1 | \
    grep -E "^attribute\.UserName" | \
    cut -d " " -f3
}

get_pass() {
    secret-tool search client bugzilla-cli workstation wintermute 2>&1 | \
    grep -E "^secret" | \
    cut -d " " -f3
}

main() {

    local bugzilla_address=https://bugzilla.suse.com

    type bugzilla >/dev/null 2>&1 || {
        echo >&2 "Bugzilla cli client not installed."
        return 1
    }

    bugzilla --username $(get_user) \
            --password $(get_pass) \
            --bugzilla $bugzilla_address \
            --restrict-login \
            login
}

main
