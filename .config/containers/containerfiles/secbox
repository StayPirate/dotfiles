FROM opensuse/leap:15.2

LABEL maintainer="Gianluca Gabrielli" mail="crazybyte@protonmail.com"
LABEL description="Portable OBS developing environment for OpenSUSE and SUSE open build services."
LABEL version="0.9"

RUN zypper addrepo http://download.suse.de/ibs/SUSE:/CA/openSUSE_Leap_15.2/SUSE:CA.repo && \
    zypper --non-interactive install -y \
        git \
        vim \
        ruby \
        ca-certificates-suse && \
    zypper addrepo https://download.suse.de/ibs/NON_Public:/maintenance:/tools/openSUSE_Leap_15.2/NON_Public:maintenance:tools.repo && \
    zypper --non-interactive --gpg-auto-import-keys refresh && \
    zypper --non-interactive install --recommends -y \
        osc \
        osc-plugin* \
        openSUSE-release-tools \
        python3-checkers && \
    zypper clean --all
RUN echo -e '\
        Cmnd_Alias ZYPPER_SAFE = \
            /usr/bin/zypper search*, \
            /usr/bin/zypper se*, \
            /usr/bin/zypper addrepo*, \
            /usr/bin/zypper ar*, \
            /usr/bin/zypper repos*, \
            /usr/bin/zypper lr*, \
            /usr/bin/zypper refresh*, \
            /usr/bin/zypper ref* \n \
        ALL ALL=NOPASSWD: ZYPPER_SAFE' \
    > /etc/sudoers.d/10_unpriv-zypper && \
    git clone  https://gitlab.suse.de/security/tools.git /sec-tools

ENV PATH "$PATH:/sec-tools"

ENTRYPOINT ["/bin/sleep", "infinity"]